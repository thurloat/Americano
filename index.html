<!DOCTYPE html>  <html> <head>   <title>Americano.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Americano.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <pre><code>    _____                                     )
   (, /  |                ,                  (   )
     /---| ___    _  __     _  _  __   ___  __)_(__
  ) /    |_// (__(/_/ (__(_(__(_(_/ (_(_)   \     /
 (_/                                         \   /_)
                                              \_/
</code></pre>

<p>Americano
<strong>Americano</strong> takes a shot at being one of those new-fangled Micro-JS-Frameworks.
The goal of the project is to allow any Coffeescript developer to create an
MVP style application without locking them into how they like to implement
Widgets or Models.</p>

<h4>It's really just the "P"</h4>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p><strong>Americano</strong> is a based on the GWT-Presenter project and it's implementation
in the SheepdogInc.ca <a href="http://app.gtraxapp.com/">project gTrax</a>. </p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The <a href="http://github.com/thurloat/Americano">source for Americano</a> is available
on GitHub.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Presenter Class</h2>

<p>You should subclass this guy for your Presenter Implementation.
The Presenter is the man in the middle between your Model and your 
Display. 
All events </p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Presenter</span>

    <span class="nv">constructor: </span><span class="nf">(@display) -&gt;</span>
        <span class="vi">@bound = </span><span class="kc">false</span>
        <span class="vi">@handlers = </span><span class="p">{}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h4>getDisplay</h4>

<p>Get the bound display for the presenter.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">getDisplay: </span><span class="nf">() -&gt;</span> <span class="nx">@display</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h4>bind</h4>

<p>The method to call to put the processing gears into action and
bind all the events   </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bind: </span><span class="nf">() -&gt;</span>
        <span class="nx">@onBind</span><span class="p">()</span>
        <span class="vi">@bound = </span><span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h4>onBind</h4>

<p>Shoddy interface. <code>:P</code></p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">onBind: </span><span class="nf">() -&gt;</span>
        <span class="nx">alert</span> <span class="s2">&quot;Unimplemented&quot;</span>
        </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h4>unbind</h4>

<p>Disables, and removes all event handlers from the presenter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">unbind: </span><span class="nf">() -&gt;</span>
        <span class="vi">@bound = </span><span class="kc">false</span>
        <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">hndlrs</span> <span class="k">of</span> <span class="nx">@handlers</span>
            <span class="k">for</span> <span class="nx">hndlr</span> <span class="k">in</span> <span class="nx">hndlrs</span>
                <span class="nx">hndlr</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
        <span class="vi">@handlers = </span><span class="p">{}</span>
    </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h4>registerHandler</h4>

<p>Registers an event handler with the Presenter with
the option of scoping it strictly to the presenter, globally, or an 
element</p>

<p>@param {<em>string</em>} <code>name</code> Name of the event</p>

<p>@param {<em>boolean | window | Element</em>} <code>scope</code> You decide.</p>

<p>@param {<em>Function</em>} <code>handler</code> The event handler</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">registerHandler: </span><span class="nf">(name, scope, handler) -&gt;</span>
        <span class="nv">hndlr = </span><span class="k">new</span> <span class="nx">Handler</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">handler</span><span class="p">)</span>

        <span class="k">if</span> <span class="nx">scope</span> <span class="o">and</span> <span class="k">typeof</span> <span class="nx">scope</span> <span class="o">is</span> <span class="s2">&quot;object&quot;</span>
            <span class="nx">hndlr</span><span class="p">.</span><span class="nx">bind</span><span class="p">()</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nx">scope</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>if the scope is set to "true", we want to register the event 
globally</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nv">hndlr.scope = </span><span class="nb">window</span>
            <span class="nx">hndlr</span><span class="p">.</span><span class="nx">bind</span><span class="p">()</span>

        <span class="nx">@handlers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="o">!</span><span class="nx">@handlers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="o">?</span>    
        <span class="nx">@handlers</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">push</span> <span class="nx">hndlr</span>        
        </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h4>unregisterHandler</h4>

<p>Removes all handlers from this presenter under an event name</p>

<p>@param {<em>string</em>} <code>name</code> The name of the event you want to remove    </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">unregisterHandler: </span><span class="nf">(name) -&gt;</span>
        <span class="k">for</span> <span class="nx">nm</span><span class="p">,</span> <span class="nx">hndlrs</span> <span class="k">of</span> <span class="nx">@handlers</span>
            <span class="k">if</span> <span class="nx">nm</span> <span class="o">==</span> <span class="nx">name</span>
                <span class="k">for</span> <span class="nx">hndlr</span> <span class="k">in</span> <span class="nx">hndlrs</span>
                    <span class="nx">hndlr</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
                <span class="nx">@handlers</span><span class="p">[</span><span class="nx">nm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h4>fireHandler</h4>

<p>FIRE HANDLE-PEDOS</p>

<p>@param {<em>string</em>} <code>name</code> The event name to fire</p>

<p>@param {<em>Object</em>} <code>data</code> The data to pass with your event</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fireHandler: </span><span class="nf">(name, data) -&gt;</span>
        <span class="k">for</span> <span class="nx">nm</span><span class="p">,</span> <span class="nx">hndlrs</span> <span class="k">of</span> <span class="nx">@handlers</span>
            <span class="k">if</span> <span class="nx">nm</span> <span class="o">==</span> <span class="nx">name</span>
                <span class="k">for</span> <span class="nx">hndlr</span> <span class="k">in</span> <span class="nx">hndlrs</span>
                    <span class="nx">hndlr</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span><span class="nx">data</span><span class="o">:</span><span class="nx">data</span><span class="p">})</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h2>Display Class</h2>

<p>I'm the interface.
I display the data from the model and provide hooks to the Presenter
to reach DEEP inside of me to handle events that I might fire. I should
not format data, or ever talk directly to a model.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Display</span>
    </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h4>asWidget</h4>

<p>You should implement me.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">asWidget: </span><span class="o">-&gt;</span> <span class="s2">&quot;unimplemented&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Handler Class</h2>

<p>A Generic event handler wrapper around managing an event.
Allows you to maintain it's stickyness to the scope and fire it.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Handler</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h4>constructor</h4>

<p>@param {<em>string</em>} <code>name</code> The name of the event the handler will handle</p>

<p>@param {<em>Object</em>} <code>scope</code> Where should one bind this event handler? to 
the window? to the wall?</p>

<p>@param {<em>Function</em>} <code>handler</code> The event handler function</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">constructor: </span><span class="nf">(@name, @scope, @handler) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h4>bind</h4>

<p>Bind the handler function to the scope</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">bind: </span><span class="nf">() -&gt;</span>
        <span class="nx">@scope</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">@name</span><span class="p">,</span> <span class="nx">@handler</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h4>remove</h4>

<p>Take the handler away from the scope</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">remove: </span><span class="nf">() -&gt;</span>
        <span class="k">if</span> <span class="nx">@scope</span>
            <span class="nx">@scope</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="nx">@name</span><span class="p">,</span> <span class="nx">@handler</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>        </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h4>call</h4>

<p>FIRE CALL-PEDOS</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">call: </span><span class="nf">(data) -&gt;</span>
        <span class="nx">@handler</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>EventBus</h2>

<p>Keeping track of events, and firing events in the global scope in hopes that
someone is listening on 'window' for the event</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">EventBus</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h4>fire</h4>

<p>Fire Event-predos, this shoots a new event across the EventBus.</p>

<p>@param {<em>string</em>} <code>eventName</code> The name of the event you wish to fire</p>

<p>@param {<em>Object</em>} <code>data</code> The data you wish for the event to receive</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">fire: </span><span class="nf">(eventName, data) -&gt;</span>
        <span class="nv">e = </span><span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span> <span class="s2">&quot;Event&quot;</span>
        <span class="nx">e</span><span class="p">.</span><span class="nx">initEvent</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
        <span class="nv">e.data = </span><span class="nx">data</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">dispatchEvent</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h4>addHandler</h4>

<p>Add a generic event handler to the global scope. Keep track of it on your
own, because a remove is not supported.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">addHandler: </span><span class="nf">(eventName, callback) -&gt;</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="nx">eventName</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h2>Espresso Machine</h2>

<p>GWT-Style Injection Machine.</p>

<p>Based on a <a href="https://gist.github.com/998920">gist</a> by: bremac</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">EspressoMachine</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h4>constructor</h4>

<p>Build a new <strong>EspressoMachine</strong> instance with a default dict of registered
factories for the EspressoMachine to inject.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span><span class="nf">(dict) -&gt;</span>
    <span class="nx">@extend</span><span class="p">(</span><span class="nx">dict</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <h4>extend</h4>

<p>Extend the <strong>EspressoMachine</strong> instance with the provided list of factories</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">extend: </span><span class="nf">(dict) -&gt;</span>
    <span class="k">for</span> <span class="nx">k</span><span class="p">,</span> <span class="nx">v</span> <span class="k">of</span> <span class="nx">dict</span>
      <span class="err">@</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">v</span>
    <span class="err">@</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <h4>register</h4>

<p>Register a new function getter with the esm. It will overwrite any existing
registry entries at that key.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">register: </span><span class="nf">(name, factory) -&gt;</span>
    <span class="err">@</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">factory</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <h4>create</h4>

<p>Create a new instance of a Type, it will read in dicts from both 
decorators <code>@PRESS</code>, which puts the args in order into the constructor for
the type; and <code>@INJECT</code>, which attaches the registered factories to the
scope of the Type so all are available via <code>@registry.foo</code> in the returned
Type object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">create: </span><span class="nf">(type) -&gt;</span>

    <span class="k">if</span> <span class="nx">type</span><span class="p">.</span><span class="nx">PRESS</span>
      <span class="nv">pressArgs = </span><span class="p">[]</span>
      <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">factory</span> <span class="k">of</span> <span class="nx">type</span><span class="p">.</span><span class="nx">PRESS</span>
        <span class="nx">pressArgs</span><span class="p">.</span><span class="nx">push</span> <span class="err">@</span><span class="p">[</span><span class="nx">factory</span><span class="p">](</span><span class="err">@</span><span class="p">)</span>
      <span class="nv">typeInstance = </span><span class="k">new</span> <span class="nx">type</span><span class="p">(</span><span class="nx">pressArgs</span><span class="p">...)</span>
    <span class="k">else</span>
      <span class="nv">typeInstance = </span><span class="k">new</span> <span class="nx">type</span><span class="p">()</span>

    <span class="nx">@inject</span><span class="p">(</span><span class="nx">typeInstance</span><span class="p">,</span> <span class="nx">type</span><span class="p">.</span><span class="nx">INJECT</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <h4>inject</h4>

<p>Perform the injection of the dict into the new Type object. An <code>@esm</code> is 
added to the scope for <code>@esm.create()</code> functionality within the created
Type.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">inject: </span><span class="nf">(obj, dict) -&gt;</span>
    <span class="k">if</span> <span class="nx">dict</span><span class="o">?</span>
      <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">factory</span> <span class="k">of</span> <span class="nx">dict</span>
        <span class="nx">obj</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="p">[</span><span class="nx">factory</span><span class="p">](</span><span class="err">@</span><span class="p">)</span>
    <span class="nv">obj.esm = </span><span class="err">@</span>
    <span class="nx">obj</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h2>Logger</h2>

<p>Hey Look, a handy-dandy logger
TODO: make me awesomer</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Logger</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <h4>defaultLogThreshold</h4>

<p>A default log threshold (this doesn't really do anything yet.)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">defaultLogThreshold = </span><span class="mi">2</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h4>log</h4>

<p>Log a message to the logger.</p>

<p>@param {<em>string</em>} <code>message</code> The message to log</p>

<p>@param {<em>int</em>} <code>logLevel</code> How much of an ermergency is it?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">log: </span><span class="nf">(message, logLevel) -&gt;</span>
        <span class="k">if</span> <span class="nx">logLevel</span> <span class="o">&gt;</span> <span class="nx">defaultLogThreshold</span>
            <span class="nx">message</span> <span class="o">+=</span> <span class="s2">&quot;!&quot;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">message</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 