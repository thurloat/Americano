(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p=Object.prototype.hasOwnProperty,q=function(a,b){function d(){this.constructor=a}for(var c in b)p.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a},r=function(a,b){return function(){return a.apply(b,arguments)}};o=function(){function a(a){this.display=a,this.bound=!1,this.handlers={}}a.prototype.getDisplay=function(){return this.display},a.prototype.bind=function(){this.onBind();return this.bound=!0},a.prototype.onBind=function(){return alert("Unimplemented")},a.prototype.unbind=function(){var a,b,c,d,e,f;this.bound=!1,f=this.handlers;for(c in f){b=f[c];for(d=0,e=b.length;d<e;d++)a=b[d],a.remove()}return this.handlers={}},a.prototype.registerHandler=function(a,b,c){var d;d=new e(a,b,c),b&&typeof b=="object"?d.bind():b&&(d.scope=window,d.bind()),this.handlers[a]==null&&(this.handlers[a]=[]);return this.handlers[a].push(d)},a.prototype.unregisterHandler=function(a){var b,c,d,e,f;e=this.handlers,f=[];for(d in e)c=e[d],f.push(function(){var e,f;if(d===a){for(e=0,f=c.length;e<f;e++)b=c[e],b.remove();return this.handlers[d]=[]}}.call(this));return f},a.prototype.fireHandler=function(a,b){var c,d,e,f,g;f=this.handlers,g=[];for(e in f)d=f[e],g.push(function(){var f,g,h;if(e===a){h=[];for(f=0,g=d.length;f<g;f++)c=d[f],h.push(c.call({data:b}));return h}}());return g};return a}(),b=function(){function a(){}a.prototype.asWidget=function(){return"unimplemented"};return a}(),e=function(){function a(a,b,c){this.name=a,this.scope=b,this.handler=c}a.prototype.bind=function(){return this.scope.addEventListener(this.name,this.handler,!1)},a.prototype.remove=function(){if(this.scope)return this.scope.removeEventListener(this.name,this.handler,!1)},a.prototype.call=function(a){return this.handler(a)};return a}(),d=function(){function a(){}a.prototype.fire=function(a,b){var c;c=document.createEvent("Event"),c.initEvent(a,!0,!0),c.data=b;return window.dispatchEvent(c)},a.prototype.addHandler=function(a,b){return window.addEventListener(a,b,!1)};return a}(),c=function(){function a(a){this.extend(a)}a.prototype.extend=function(a){var b,c;for(b in a)c=a[b],this[b]=c;return this},a.prototype.register=function(a,b){return this[a]=b},a.prototype.create=function(a){var b,c,d,e,f;if(a.PRESS){d=[],f=a.PRESS;for(c in f)b=f[c],d.push(this[b](this));e=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(a,d,function(){})}else e=new a;return this.inject(e,a.INJECT)},a.prototype.inject=function(a,b){var c,d;if(b!=null)for(d in b)c=b[d],a[d]=this[c](this);a.esm=this;return a};return a}(),f=function(){function b(){}var a;a=2,b.prototype.log=function(b,c){c>a&&(b+="!");return console.log(b)};return b}(),l=function(){function a(){a.__super__.constructor.apply(this,arguments)}q(a,o),a.PRESS={display:"noteDisplayType"},a.INJECT={eventBus:"getEventBus",logger:"getLogger",DB:"getDB"},a.prototype.onBind=function(){this.registerHandler("newNote",!0,r(function(a){return this.setNote({title:"",body:""})},this)),this.registerHandler("loadNote",!0,r(function(a){this.setNote(a.data);return this.eventBus.fire("notify",{message:"Loaded Note:"+a.data.title})},this)),this.registerHandler("click",this.display.getSaveButton(),r(function(a){this.note.title=this.display.getTitleBoxValue(),this.note.body=this.display.getBodyBoxValue();return this.DB.save(this.note,r(function(){this.eventBus.fire("refreshDisplay");return this.eventBus.fire("notify",{message:"Note Saved"})},this))},this));return this.registerHandler("refreshDisplay",!0,r(function(a){return this.fireHandler("newNote")},this))},a.prototype.setNote=function(a){this.note=a,this.display.setTitleBoxValue(a.title);return this.display.setBodyBoxValue(a.body)};return a}(),g=function(){function a(){var a;this.titleBox=document.createElement("input"),this.titleBox.setAttribute("type","text"),a=document.createElement("h4"),a.innerText="Body",this.bodyBox=document.createElement("textarea"),this.saveButton=document.createElement("input"),this.saveButton.setAttribute("type","submit"),this.saveButton.setAttribute("value","Save"),this.container=document.createElement("div"),this.container.setAttribute("class","editor"),this.container.innerHTML="<h2>Note Editor</h2><h4>Title</h4>",this.container.appendChild(this.titleBox),this.container.appendChild(a),this.container.appendChild(this.bodyBox),this.container.appendChild(this.saveButton)}q(a,b),a.prototype.getSaveButton=function(){return this.saveButton},a.prototype.getTitleBoxValue=function(){return this.titleBox.value},a.prototype.setTitleBoxValue=function(a){return this.titleBox.value=a},a.prototype.getBodyBoxValue=function(){return this.bodyBox.value},a.prototype.setBodyBoxValue=function(a){return this.bodyBox.value=a},a.prototype.asWidget=function(){return this.container};return a}(),k=function(){function a(){a.__super__.constructor.apply(this,arguments)}q(a,o),a.PRESS={display:"noteListDisplayType"},a.INJECT={eventBus:"getEventBus",logger:"getLogger",DB:"getDB"},a.prototype.onBind=function(){this.notes=[],this.registerHandler("click",this.display.getNewNoteButton(),r(function(a){this.eventBus.fire("newNote",null);return this.eventBus.fire("notify",{message:"Creating New Note"})},this)),this.registerHandler("noteClicked",!0,r(function(a){return this.eventBus.fire("loadNote",a.data.note)},this)),this.registerHandler("noteDeleteClicked",!0,r(function(a){this.eventBus.fire("notify",{message:"Deleting Note"});return this.DB.remove(a.data.note.key,r(function(){return this.eventBus.fire("refreshDisplay")},this))},this)),this.registerHandler("refreshDisplay",!0,r(function(a){return this.refresh()},this));return this.refresh()},a.prototype.refresh=function(){var a,b,c,d;d=this.notes;for(b=0,c=d.length;b<c;b++)a=d[b],a.unbind();this.notes=[],this.display.clearNotes();return this.DB.all(r(function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(this.addNote(b));return e},this))},a.prototype.addNote=function(a){var b;b=this.esm.create(j),b.setNote(a),b.bind(),this.display.addNote(b.getDisplay().asWidget());return this.notes.push(b)};return a}(),h=function(){function a(){this.container=document.createElement("div"),this.container.setAttribute("class","noteList"),this.noteWidgets=[],this.container.innerHTML="<h2>My Notes</h2>",this.newButton=document.createElement("input"),this.newButton.setAttribute("type","submit"),this.newButton.setAttribute("value","New Note"),this.container.appendChild(this.newButton),this.noteList=document.createElement("ul"),this.container.appendChild(this.noteList)}q(a,b),a.prototype.getNoteList=function(){return this.noteList},a.prototype.getNewNoteButton=function(){return this.newButton},a.prototype.addNote=function(a){this.noteList.appendChild(a);return this.noteWidgets.push(a)},a.prototype.clearNotes=function(){this.noteWidgets=[];return this.noteList.innerHTML=""},a.prototype.asWidget=function(){return this.container};return a}(),j=function(){function a(){a.__super__.constructor.apply(this,arguments)}q(a,o),a.PRESS={display:"noteListItemDisplayType"},a.INJECT={eventBus:"getEventBus",logger:"getLogger",DB:"getDB"},a.prototype.setNote=function(a){this.note=a},a.prototype.onBind=function(){this.registerHandler("click",this.display.getListItem(),r(function(a){return this.eventBus.fire("noteClicked",{note:this.note})},this)),this.registerHandler("click",this.display.getDeleteButton(),r(function(a){return this.eventBus.fire("noteDeleteClicked",{note:this.note})},this));return this.display.setText(this.note.title)};return a}(),i=function(){function a(){this.noteLabel=document.createElement("span"),this.container=document.createElement("li"),this.container.appendChild(this.noteLabel),this.deleteButton=document.createElement("span"),this.deleteButton.setAttribute("class","delete"),this.deleteButton.innerText="x",this.container.appendChild(this.deleteButton)}q(a,b),a.prototype.getListItem=function(){return this.noteLabel},a.prototype.getDeleteButton=function(){return this.deleteButton},a.prototype.setText=function(a){return this.noteLabel.innerText=a},a.prototype.asWidget=function(){return this.container};return a}(),n=function(){function a(){a.__super__.constructor.apply(this,arguments)}q(a,o),a.PRESS={display:"notificationDisplayType"},a.INJECT={eventBus:"getEventBus",logger:"getLogger",DB:"getDB"},a.prototype.onBind=function(){return this.registerHandler("notify",!0,r(function(a){this.display.setText(a.data.message);return this.display.flashMessage()},this))};return a}(),m=function(){function a(){this.showingMessage=!1,this.container=document.createElement("div"),this.container.setAttribute("class","notification"),this.notification=document.createElement("span"),this.notification.innerText="waiting on notifications",this.container.appendChild(this.notification)}q(a,b),a.prototype.flashMessage=function(){if(this.showingMessage===!1){this.showingMessage=!0;return emile(this.container,"opacity:1.0",{duration:250},r(function(){return emile(this.container,"opacity:0",{duration:1500},r(function(){return this.showingMessage=!1},this))},this))}},a.prototype.setText=function(a){return this.notification.innerText=a},a.prototype.asWidget=function(){return this.container};return a}(),a=function(){function p(){}var a,b,e,j,o;b=new c,e=new d,o=new f,a=new Lawnchair("Notes",function(){return console.log("Database Loaded.")}),j=!1,p.prototype.run=function(){var c,d,f,p,q,r;if(j){console.log("run");return!1}j=!0,b.register("getEventBus",function(){return e}),b.register("getLogger",function(){return o}),b.register("getRootPanel",function(){return document.getElementById("application")}),b.register("getDB",function(){return a}),c=new g,d=new h,q=new m,b.register("noteDisplayType",function(){return c}),b.register("noteListDisplayType",function(){return d}),b.register("notificationDisplayType",function(){return q}),b.register("noteListItemDisplayType",function(){return new i}),p=b.create(l),f=b.create(k),r=b.create(n),p.bind(),f.bind(),r.bind(),b.getRootPanel().appendChild(r.getDisplay().asWidget()),b.getRootPanel().appendChild(p.getDisplay().asWidget());return b.getRootPanel().appendChild(f.getDisplay().asWidget())};return p}(),window.ready(function(){var b;b=new a,window&&(window.APP=b);return b.run()})}).call(this)